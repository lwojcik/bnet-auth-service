image: Ubuntu
platform: x64
stack: node lts/*
services:
  - docker

install:
  - npm install

build_script:
  - npm run build
  - docker build -t "${DOCKER_TAG}" . --no-cache

test_script:
  - npx codecov

after_build:
  - echo "${APPVEYOR_BUILD_NUMBER}"
  - echo "${APPVEYOR_BUILD_VERSION}"
  - echo "${APPVEYOR_REPO_NAME}"
  - if [[ "${APPVEYOR_REPO_BRANCH}" == "docker_build_on_master" ]]; then echo "${DOCKER_PASSWORD}" | docker login "${DOCKER_REGISTRY}" -u "${DOCKER_USERNAME}" --password-stdin; fi
  - if [[ "${APPVEYOR_REPO_BRANCH}" == "docker_build_on_master" ]]; then docker push "${DOCKER_TAG}"; fi
  - if [[ "${APPVEYOR_REPO_BRANCH}" == "docker_build_on_master" ]]; then docker push "${DOCKER_TAG}"; fi
